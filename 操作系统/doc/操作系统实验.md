
# 1. 操作系统引导
## 基础知识
因为计算机的工作本质就是**取指执行**，所以我们刚打开电源时，我们需要关注**指针IP**和其**指向的内容**

### x86计算机中开始加电过程
1. X86计算机刚开始时CPU处于实模式
2. 开机时，段寄存器CS=0xFFFF  段内偏移IP=0x0000（地址 = CS<<4+IP） 计算后刚好等于BIOS地址0xFFFF0
3. 寻址0xFFFF0(ROM BIOS映射区)
4. 检查RAM，键盘，显示器，软硬磁盘
5. 将磁盘0磁道0扇区(**操作系统引导扇区**)读入0x7c00处（1个扇区512字节）
6. 设置CS=0x07c0，IP = 0x0000  计算后刚好为0x7c00处  

### 0x7c00处存放的代码bootsect.s
从上面可以了解到0x7c00处就是从磁盘引导扇区读入的512个字节，即**bootsect.s**  

### bootsect.s源代码

下面的代码用来将0x07c0:0x0000处的512字节即bootsect.s移动到0x900:0x0000处，腾出空间  
![bootsect.s](https://github.com/ChenLiang-Vic/Personal-notes/blob/master/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/img/bootsect.png)

接下来使用13号中断读取setup的4个扇区  
![bootsect2.s](https://github.com/ChenLiang-Vic/Personal-notes/blob/master/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/img/bootsect2.png)

读入setup后使用10号中断显示字符（即我们平时开机时显示的黑屏的操作系统logo)  
![bootsect3.s](https://github.com/ChenLiang-Vic/Personal-notes/blob/master/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/img/bootsect3.png)

之后继续使用13号中断读取操作系统剩余部分bootset结束，进入setup  
![bootsect4.s](https://github.com/ChenLiang-Vic/Personal-notes/blob/master/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/img/bootsect4.png)

### setup.s源代码


## 实验
### 1.改写bootsect.s
主要完成如下功能：bootsect.s能在屏幕上打印一段提示信息“XXX is booting...”，其中XXX是你给自己的操作系统起的名字，例如LZJos、Sunix等

从上面的bootsect.s的源码分析中可以知道，只需要修改**Loading System...** 处和**控制其字符显示长度的cx处**即可,实验结果如下图所示：  

![bootsect实验结果](https://github.com/ChenLiang-Vic/Personal-notes/blob/master/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/img/bootsect%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C.png)

### 2.改写setup.s
主要完成如下功能：
- bootsect.s能完成setup.s的载入，并跳转到setup.s开始地址执行。而setup.s向屏幕输出一行"Now we are in SETUP"。  
- setup.s能获取至少一个基本的硬件参数（如内存参数、显卡参数、硬盘参数等），将其存放在内存的特定地址，并输出到屏幕上。 
- setup.s不再加载Linux内核，保持上述信息显示在屏幕上即可。  



# 2. 系统调用