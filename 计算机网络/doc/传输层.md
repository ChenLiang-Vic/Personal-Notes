## 传输层
运输层向它上面应用层提供通信服务，它属于面向通信部分的最高层，同时也是用户功能中的最底层。

两个主机进行通信实际上就是**两个主机中的应用进程互相通信**。应用进程之间的通信又称为**端到端的通信**。
![传输层]()

传输层有两种不同的协议：**用户数据报协议UDP**和**传输控制协议TCP**

学习这两个重要协议之前，先简单了解下端口的概念。
#### 端口
为了使运行不同操作系统的计算机的应用进程能够互相通信，就必须用统一的方法**对 TCP/IP 体系的应用进程进行标志**。解决这个问题的方法就是在运输层使用**协议端口号**(protocol port number)，或通常简称为**端口**(port)，端口用一个 16 位端口号进行标志。

**端口号只具有本地意义**，即端口号只是为了标志本计算机应用层中的各进程。在因特网中不同计算机的相同端口号是没有联系的。

端口号分为两类：

1. 服务端使用的端口号
服务器端使用的端口又分为两类：
    - 熟知端口（well-known port number），数值一般为0~1023。管理机构IANA把这些端口指派给TCP/IP最重要的一些应用程序，让所有用户都知道。
![熟知端口]()
    - 登记端口，数值为1024~49151，为没有熟知端口号的应用程序使用的。使用这个范围的端口号必须在 IANA 登记，以防止重复。
2. 客户端使用的端口号
数值为49152~65535，留给客户进程选择暂时使用，仅在客户进程运行时彩动态选择，因此又叫**短暂端口号**。当服务器进程收到客户进程的报文时，就知道了客户进程所使用的动态端口号。通信结束后，这个端口号可供其他客户进程以后使用。

## 用户数据报协议UDP
### UDP特点
- **无连接**   (即发送数据之前不需要建立连接)
- **不可靠**   (UDP使用尽最大努力交付，即不保证可靠交付，同时也不使用拥塞控制)
- **面向报文** (对于应用程序传下来的报文不合并也不拆分，只是添加 UDP 首部)
- **支持一对一、一对多、多对一、多对多的交互通信**

### UDP首部
![UDP首部]()
首部字段只有 8 个字节，包括源端口、目的端口、长度、检验和。12 字节的伪首部是为了计算检验和临时添加的。
## 控制连接协议TCP
### TCP特点
### TCP首部
![TCP首部]()
- **序号** ：用于对字节流进行编号，例如序号为 301，表示第一个字节的编号为 301，如果携带的数据长度为 100 字节，那么下一个报文段的序号应为 401。

- **确认号** ：期望收到的下一个报文段的序号。例如 B 正确收到 A 发送来的一个报文段，序号为 501，携带的数据长度为 200 字节，因此 B 期望下一个报文段的序号为 701，B 发送给 A 的确认报文段中确认号就为 701。

- **数据偏移** ：指的是数据部分距离报文段起始处的偏移量，实际上指的是首部的长度。

- **确认 ACK** ：当 ACK=1 时确认号字段有效，否则无效。TCP 规定，在连接建立后所有传送的报文段都必须把 ACK 置 1。

- **同步 SYN** ：在连接建立时用来同步序号。当 SYN=1，ACK=0 时表示这是一个连接请求报文段。若对方同意建立连接，则响应报文中 SYN=1，ACK=1。

- **终止 FIN** ：用来释放一个连接，当 FIN=1 时，表示此报文段的发送方的数据已发送完毕，并要求释放连接。

- **窗口** ：窗口值作为接收方让发送方设置其发送窗口的依据。之所以要有这个限制，是因为接收方的数据缓存空间是有限的。