<!-- TOC -->

- [域名系统DNS](#域名系统dns)
- [文件传送协议 FTP](#文件传送协议-ftp)
- [电子邮件协议SMTP、POP3、IMAP](#电子邮件协议smtppop3imap)
- [DHCP协议](#dhcp协议)

<!-- /TOC -->

使用TCP和UDP的各种常见应用层协议
<div align="center"> <img src="http://q6rfyn8ub.bkt.clouddn.com/%E5%BA%94%E7%94%A8%E5%B1%82%E5%8D%8F%E8%AE%AE.png"></div><br>

## 域名系统DNS  
DNS 是一个通过分层服务器实现的分布式数据库，**提供了主机名和 IP 地址之间相互转换的服务**。这里的分布式数据库是指，每个站点只保留与它相关的那部分数据。

DNS可以使用UDP或者TCP进行传输，使用的端口号都为 53。**大多数情况下DNS使用UDP进行传输**，这就要求域名解析器和域名服务器都必须自己处理超时和重传从而保证可靠性。

**在两种情况下会使用TCP进行传输**：
- 如果返回的响应超过的 512 字节（UDP 最大只支持512字节的数据）。
- 区域传送（区域传送是主域名服务器向辅助域名服务器传送变化的那部分数据）。

DNS工作流程：
本地域名服务器采用**递归查询**
<div align="center"> <img src="http://q6rfyn8ub.bkt.clouddn.com/DNS%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png"></div><br>

---
## 文件传送协议 FTP 
文件传送协议 FTP (File Transfer Protocol) 是互联网上使用得最广泛的文件传送协议。

FTP 提供交互式的访问，允许客户指明文件的类型与格式，并允许文件具有存取权限

文件传输过程
1. 打开熟知端口（端口号为 21），使客户进程能够连接上。
2. 等待客户进程发出连接请求。
3. 启动从属进程来处理客户进程发来的请求。从属进程对客户进程的请求处理完毕后即终止，但从属进程在运行期间根据需要还可能创建其他一些子进程。
4. 回到等待状态，继续接受其他客户进程发来的请求。主进程与从属进程的处理是并发地进行。
5. 当客户进程向服务器进程发出建立连接请求时，要寻找连接服务器进程的熟知端口 (21)，同时还要告诉服务器进程自己的另一个端口号码，用于建立数据传送连接。
6. 服务器进程用自己传送数据的熟知端口 (20) 与客户进程所提供的端口号码建立数据传送连接。
7. 由于 FTP 使用了两个不同的端口号，所以数据连接与控制连接不会发生混乱。

**FTP是使用了两个TCP连接**的。好处：
- 使协议更加简单和更容易实现。
- 在传输文件时还可以利用控制连接（例如，客户发送请求终止传输）。

<div align="center"> <img src="http://q6rfyn8ub.bkt.clouddn.com/FTP.png"></div><br>

---
## 电子邮件协议SMTP、POP3、IMAP
<div align="center"> <img src="http://q6rfyn8ub.bkt.clouddn.com/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E5%8D%8F%E8%AE%AE.png"></div><br>

注意：
- 不要将邮件读取协议 POP 或 IMAP 与邮件传送协议 SMTP 弄混。
- 发信人的用户代理向源邮件服务器发送邮件，以及源邮件服务器向目的邮件服务器发送邮件，都是使用 SMTP 协议。
- 而 POP 协议或 IMAP 协议则是用户从目的邮件服务器上读取邮件所使用的协议。

---

## DHCP协议

为了将软件协议做成通用的和便于移植，协议软件的编写者把协议软件参数化。在软件协议运行之前，必须给每一个参数赋值。
在协议软件中给这些参数赋值的动作叫做协议配置。

互联网广泛使用的**动态主机配置协议 DHCP (Dynamic Host Configuration Protocol)** 提供了**即插即用连网**(plug-and-play networking) 的机制。

并不是每个网络上都有 DHCP 服务器，这样会使 DHCP 服务器的数量太多。现在是每一个网络至少有一个 DHCP 中继代理，它配置了 DHCP 服务器的 IP 地址信息。

<div align="center"> <img src="http://q6rfyn8ub.bkt.clouddn.com/DHCP%E5%8D%8F%E8%AE%AE.png"></div><br>


注意：
- DHCP报文仅为UDP数据报的数据部分
- DHCP 服务器分配给 DHCP 客户的 IP 地址的**临时的**，因此 DHCP 客户只能在一段有限的时间内使用这个分配到的IP 地址。